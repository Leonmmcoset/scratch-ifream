{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@leonmmcoset/scratch-ifream/webpack/bootstrap","webpack://@leonmmcoset/scratch-ifream/webpack/runtime/compat get default export","webpack://@leonmmcoset/scratch-ifream/webpack/runtime/define property getters","webpack://@leonmmcoset/scratch-ifream/webpack/runtime/hasOwnProperty shorthand","webpack://@leonmmcoset/scratch-ifream/webpack/runtime/make namespace object","webpack://@leonmmcoset/scratch-ifream/external root \"flarum.reg.get('core', 'common/app')\"","webpack://@leonmmcoset/scratch-ifream/./src/common/index.ts","webpack://@leonmmcoset/scratch-ifream/external root \"flarum.reg.get('core', 'forum/app')\"","webpack://@leonmmcoset/scratch-ifream/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://@leonmmcoset/scratch-ifream/external root \"flarum.reg.get('core', 'common/components/Button')\"","webpack://@leonmmcoset/scratch-ifream/external root \"flarum.reg.get('core', 'common/components/Modal')\"","webpack://@leonmmcoset/scratch-ifream/external root \"flarum.reg.get('core', 'common/components/TextField')\"","webpack://@leonmmcoset/scratch-ifream/external root \"flarum.reg.get('core', 'common/components/TextEditor')\"","webpack://@leonmmcoset/scratch-ifream/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://@leonmmcoset/scratch-ifream/./src/forum/extend.ts","webpack://@leonmmcoset/scratch-ifream/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://@leonmmcoset/scratch-ifream/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://@leonmmcoset/scratch-ifream/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://@leonmmcoset/scratch-ifream/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/app');","import app from 'flarum/common/app';\napp.initializers.add('leonmmcoset-scratch-ifream-common', () => {\n  console.log('[leonmmcoset/scratch-ifream] Hello, forum and admin!');\n});","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/app');","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Button');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Modal');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/TextField');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/TextEditor');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extend');","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n// Hello world!\n\nimport app from 'flarum/forum/app';\nimport Button from 'flarum/common/components/Button';\nimport Modal from 'flarum/common/components/Modal';\nimport TextField from 'flarum/common/components/TextField';\nimport TextEditor from 'flarum/common/components/TextEditor';\nimport { extend } from 'flarum/common/extend';\nclass ScratchIframeModal extends Modal {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"url\", '');\n  }\n  className() {\n    return 'ScratchIframeModal Modal--small';\n  }\n  title() {\n    return '添加Scratch项目链接';\n  }\n  content() {\n    return m('div', {\n      className: 'Modal-body'\n    }, [m('div', {\n      className: 'Form-group'\n    }, [m(TextField, {\n      label: 'Scratch项目链接',\n      placeholder: '输入Scratch项目链接',\n      value: this.url,\n      oninput: value => {\n        this.url = value;\n      }\n    })]), m('div', {\n      className: 'Form-group'\n    }, [m(Button, {\n      className: 'Button Button--primary',\n      onclick: this.onSubmit.bind(this)\n    }, '添加')])]);\n  }\n\n  // 新增：添加onSubmit方法\n  onSubmit() {\n    var _app$forum, _app$forum2;\n    // 添加调试日志\n    console.log('[ScratchIframeModal] 开始提交');\n    console.log('[ScratchIframeModal] app 对象:', app);\n    console.log('[ScratchIframeModal] app.forum 对象:', app.forum);\n    console.log('[ScratchIframeModal] app.forum.attribute 类型:', typeof ((_app$forum = app.forum) == null ? void 0 : _app$forum.attribute));\n    if (!this.url) {\n      console.log('[ScratchIframeModal] URL 为空，取消提交');\n      return;\n    }\n    const editor = this.attrs.editor;\n    // 添加 URL 构造调试\n    const baseUrl = (_app$forum2 = app.forum) == null ? void 0 : _app$forum2.attribute('leonmmcoset-scratch-ifream.run_url');\n    console.log('[ScratchIframeModal] 配置的基础 URL:', baseUrl);\n    const iframeUrl = baseUrl ? baseUrl + encodeURIComponent(this.url) : '';\n    if (!iframeUrl) {\n      console.error('[ScratchIframeModal] 基础 URL 未配置，无法生成 iframe 地址');\n      return;\n    }\n    const iframeHtml = \"<iframe src=\\\"\".concat(iframeUrl, \"\\\" width=\\\"100%\\\" height=\\\"600\\\" frameborder=\\\"0\\\" allowfullscreen></iframe>\");\n    console.log('[ScratchIframeModal] 生成的 iframe HTML:', iframeHtml);\n    editor.insertAtCursor(iframeHtml);\n    this.hide();\n  }\n}\n\n// 仅保留一个默认导出（函数形式）\nexport default function initialize() {\n  app.initializers.add('leonmmcoset-scratch-ifream', () => {\n    extend(TextEditor.prototype, 'toolbarItems', function (items) {\n      // 关键修改：校验用户权限\n      const user = app.session.user;\n      if (!user || !user.hasPermission('leonmmcoset.scratch-ifream.use')) {\n        return; // 无权限则不添加按钮\n      }\n      items.add('scratch-iframe', m(Button, {\n        icon: 'fas fa-code',\n        onclick: () => {\n          // 添加模态框显示前的调试\n          console.log('[ScratchIframeModal] 准备显示模态框');\n          console.log('[ScratchIframeModal] app.modal 对象:', app.modal);\n          console.log('[ScratchIframeModal] 当前编辑器实例:', this);\n          app.modal.show(ScratchIframeModal, {\n            editor: this\n          });\n        }\n      }, app.translator.trans('leonmmcoset-scratch-ifream.forum.add_scratch_button')));\n    });\n  });\n}","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import app from 'flarum/forum/app';\nexport { default as extend } from './extend';\napp.initializers.add('leonmmcoset-scratch-ifream', () => {\n  console.log('[leonmmcoset/scratch-ifream] Hello, forum!');\n});"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","reg","add","console","log","_typeof","iterator","constructor","ScratchIframeModal","e","r","super","arguments","this","t","i","toPrimitive","TypeError","String","toPropertyKey","configurable","writable","className","title","content","m","label","placeholder","url","oninput","onclick","onSubmit","bind","_app$forum","_app$forum2","attribute","editor","attrs","baseUrl","iframeUrl","encodeURIComponent","error","iframeHtml","concat","insertAtCursor","hide","initialize","extend","items","user","hasPermission","icon","show","trans"],"sourceRoot":""}