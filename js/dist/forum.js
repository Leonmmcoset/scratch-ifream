(()=>{var o={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return o.d(r,{a:r}),r},d:(e,r)=>{for(var t in r)o.o(r,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o:(o,e)=>Object.prototype.hasOwnProperty.call(o,e),r:o=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})}},e={};(()=>{"use strict";o.r(e),o.d(e,{extend:()=>b});const r=flarum.reg.get("core","common/app");o.n(r)().initializers.add("leonmmcoset-scratch-ifream-common",(()=>{console.log("[leonmmcoset/scratch-ifream] Hello, forum and admin!")}));const t=flarum.reg.get("core","forum/app");var a=o.n(t);function c(o){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},c(o)}const n=flarum.reg.get("core","common/components/Button");var l=o.n(n);const i=flarum.reg.get("core","common/components/Modal");var s=o.n(i);const u=flarum.reg.get("core","common/components/TextField");var f=o.n(u);const d=flarum.reg.get("core","common/components/TextEditor");var h=o.n(d);const p=flarum.reg.get("core","common/extend");class g extends(s()){constructor(){var o,e;super(...arguments),o=this,(e=function(o){var e=function(o){if("object"!=c(o)||!o)return o;var e=o[Symbol.toPrimitive];if(void 0!==e){var r=e.call(o,"string");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(o);return"symbol"==c(e)?e:e+""}(e="url"))in o?Object.defineProperty(o,e,{value:"",enumerable:!0,configurable:!0,writable:!0}):o[e]=""}className(){return"ScratchIframeModal Modal--small"}title(){return"添加Scratch项目链接"}content(){return m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m(f(),{label:"Scratch项目链接",placeholder:"输入Scratch项目链接",value:this.url,oninput:o=>{this.url=o}})]),m("div",{className:"Form-group"},[m(l(),{className:"Button Button--primary",onclick:this.onSubmit.bind(this)},"添加")])])}onSubmit(){var o,e;if(console.log("[ScratchIframeModal] 开始提交"),console.log("[ScratchIframeModal] app 对象:",a()),console.log("[ScratchIframeModal] app.forum 对象:",a().forum),console.log("[ScratchIframeModal] app.forum.attribute 类型:",typeof(null==(o=a().forum)?void 0:o.attribute)),!this.url)return void console.log("[ScratchIframeModal] URL 为空，取消提交");const r=this.attrs.editor,t=null==(e=a().forum)?void 0:e.attribute("leonmmcoset-scratch-ifream.run_url");console.log("[ScratchIframeModal] 配置的基础 URL:",t);const c=t?t+encodeURIComponent(this.url):"";if(!c)return void console.error("[ScratchIframeModal] 基础 URL 未配置，无法生成 iframe 地址");const n='<iframe src="'.concat(c,'" width="100%" height="600" frameborder="0" allowfullscreen></iframe>');console.log("[ScratchIframeModal] 生成的 iframe HTML:",n),r.insertAtCursor(n),this.hide()}}function b(){a().initializers.add("leonmmcoset-scratch-ifream",(()=>{(0,p.extend)(h().prototype,"toolbarItems",(function(o){const e=a().session.user;e&&e.hasPermission("leonmmcoset.scratch-ifream.use")&&o.add("scratch-iframe",m(l(),{icon:"fas fa-code",onclick:()=>{console.log("[ScratchIframeModal] 准备显示模态框"),console.log("[ScratchIframeModal] app.modal 对象:",a().modal),console.log("[ScratchIframeModal] 当前编辑器实例:",this),a().modal.show(g,{editor:this})}},a().translator.trans("leonmmcoset-scratch-ifream.forum.add_scratch_button")))}))}))}a().initializers.add("leonmmcoset-scratch-ifream",(()=>{console.log("[leonmmcoset/scratch-ifream] Hello, forum!")}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map